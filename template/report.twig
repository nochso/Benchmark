{% extends 'layout.twig' %}
{% import _self as macro %}
{% block content %}
  <div class="row">
    <h1>{{ title }}</h1>

    {{ report.getDescription|markdown }}

    {% if report.unitList|length > 1 %}
    <ul>
      {% for unitName, unit in report.unitList %}
        <li><a href="#{{ unitName|slugify }}">{{ unitName }}</a></li>
      {% endfor %}
    </ul>
    {% endif %}
    {% for unitName, unit in report.unitList %}
      {{ block('unit') }}
    {% endfor %}

    <dl>
      <dt><a href="https://github.com/nochso/benchmark">nochso/Benchmark</a></dt>
      <dd>{{ constant('nochso\\Benchmark\\Report::BENCHMARK_VERSION') }}</dd>
      <dt>ran each test</dt>
      <dd>&gt; {{ min_duration }} ms</dd>

      <dt>on</dt>
      <dd>{{ macro.datetime('now') }}</dd>
      <dt>in</dt>
      <dd>{{ duration|number_format(1) }} seconds</dd>
      <dt>using PHP</dt>
      <dd>{{ constant('PHP_VERSION') }}</dd>
      <dt><span title="only Zend extensions are listed">with</span></dt>
      {% for ext in zend_extensions %}
        <dd>{{ ext }}</dd>
      {% else %}
        <dd>no Zend extensions</dd>
      {% endfor %}
      <dt>on</dt>
      <dd>{{ os }}</dd>
    </dl>
  </div>
{% endblock %}

{% macro datetime(dt) %}
  {% set rfc3339 = dt|date(constant('DateTime::RFC3339')) %}
  <time datetime="{{ rfc3339 }}" title="{{ rfc3339 }}">{{ dt|date('M. jS, Y H:i T') }}</time>
{% endmacro %}

{% block unit %}
  <h2><a name="{{ unitName|slugify }}"></a> {{ unitName }}</h2>
  {{ unit.getDescription|markdown }}
  {% if loop.first %}
    <div class="note">
    {% markdown %}
    #### Explanation of results
    Results are measured in **operations per second** (K = 1000, M = 1,000,000).

    The method score is based on the median average. The fastest method always has a base score of 1x and other
    methods are compared to it. For example a score of 3x means it's 3 times slower than the fastest method.

    You can see the source code of the closure by clicking on the method name.
    {% endmarkdown %}
    </div>
  {% endif %}
  <table>
    <thead>
    <tr>
      <th>Method</th>
      {% for result in unit.getResult.getMethodResults(unit.getMethods|first, true) %}
        {% if result.getParameter is not null %}
        <th>{{ result.getParameter.getName }}</th>
          {% endif %}
      {% endfor %}
      <th>Score</th>
    </tr>
    </thead>
    <tbody>
    {{ block('methods') }}
    </tbody>
  </table>
{% endblock %}

{% block methods %}
  {% for methodName, method in unit.getMethods %}
    <tr>
      <td>
        <label class="collapse" for="_{{ methodName|slugify }}">{{ methodName|markdown }}</label>
        <input id="_{{ methodName|slugify }}" type="checkbox">
        <div>
          {{ method.getDescription|markdown }}
          <pre><code>{{ method.getSourceCode }}</code></pre>
        </div>
      </td>
      {% set unitResult = unit.getResult %}
      {% for result in unitResult.getMethodResults(method, true) %}
        <td>{{ result.getOperationsPerSecond(true) }}</td>
      {% endfor %}
      <td class="text-right score" style="background-color: {{ unitResult.getMethodScoreColor(method) }}"><span>{{ unitResult.getMethodScore(method)|number_format(1) }}x</span></td>
    </tr>
  {% endfor %}
{% endblock %}