<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="robots" content="index, follow, all" /><title>nochso\Benchmark\Unit | noch.so Benchmark documentation</title><link rel="stylesheet" type="text/css" href="../../css/normalize.css"><link rel="stylesheet" type="text/css" href="../../css/min.css"><link rel="stylesheet" type="text/css" href="../../css/prism.css"><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,400italic' rel='stylesheet' type='text/css'><script src="../../js/prism.js"></script><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"></head><body id="class" data-name="class:nochso_Benchmark_Unit" data-root-path="../../"><nav><div class="container"><div class="title"><a href="../../index.html">noch.so Benchmark documentation</a></div><ul><li><a href="../../classes.html">Classes</a></li><li><a href="../../namespaces.html">Namespaces</a></li><li><a href="../../interfaces.html">Interfaces</a></li><li><a href="../../traits.html">Traits</a></li><li><a href="../../doc-index.html">Index</a></li><li><a href="../../search.html">Search</a></li></ul><ol class="breadcrumb"><li><a href="../../nochso.html">nochso</a></li><li><a href="../../nochso/Benchmark.html">Benchmark</a></li><li>Unit</li></ol></div></nav><div class="container"><div class="row"><div id="control-panel"></div><div id="api-tree"></div></div><div class="row"><h1>Unit</h1><p> class <strong>Unit</strong></p><p>Unit is a list of related methods and the parameters they're called with.</p><p>The combination of different implementations (Method objects) and their parameters should be related as their results should be comparable.</p><h2>Methods</h2><table class="table"><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method___construct">__construct</a>(string $name, string $description = &#039;&#039;)</code></td><td> Both parameters are interpreted as Markdown. </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Method.html"><abbr title="nochso\Benchmark\Method">Method</abbr></a>[]</code></td><td><code class="language-php"><a href="#method_getMethods">getMethods</a>()</code></td><td> Return first list of all methods. Sorted by score if available. </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Parameter.html"><abbr title="nochso\Benchmark\Parameter">Parameter</abbr></a>[]</code></td><td><code class="language-php"><a href="#method_getParams">getParams</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a></code></td><td><code class="language-php"><a href="#method_getResult">getResult</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php">string</code></td><td><code class="language-php"><a href="#method_getDescription">getDescription</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_setProgress">setProgress</a>(<a href="../../nochso/Benchmark/Progress.html"><abbr title="nochso\Benchmark\Progress">Progress</abbr></a> $progress)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php">string</code></td><td><code class="language-php"><a href="#method_getName">getName</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_addMethod">addMethod</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_addClosure">addClosure</a>(<abbr title="nochso\Benchmark\Closure">Closure</abbr> $closure, string $name, string $description = &#039;&#039;)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_addParam">addParam</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Parameter">Parameter</abbr> $parameter)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a></code></td><td><code class="language-php"><a href="#method_run">run</a>()</code></td><td> Runs all combinations and returns results grouped by method name. </td><td></td></tr></table><h2>Details</h2><div id="method-details"><div><div class="float-right"> at line <a href="#source.57">57</a></div><div><h3 id="method___construct"><code class="language-php">__construct()</code></h3><code class="language-php">public __construct(string $name, string $description = &#039;&#039;)</code></div></div><div class="details"><div><p>Both parameters are interpreted as Markdown.</p></div><h4>Parameters</h4><table class="table"><tr><td><code class="language-php">string</code></td><td><code class="language-php">$name</code></td><td></td></tr><tr><td><code class="language-php">string</code></td><td><code class="language-php">$description</code></td><td>Optional</td></tr></table></div><div><div class="float-right"> at line <a href="#source.68">68</a></div><div><h3 id="method_getMethods"><code class="language-php">getMethods()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Method.html"><abbr title="nochso\Benchmark\Method">Method</abbr></a>[]&nbsp;getMethods()</code></div></div><div class="details"><div><p>Return first list of all methods. Sorted by score if available.</p></div><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Method.html"><abbr title="nochso\Benchmark\Method">Method</abbr></a>[]</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.76">76</a></div><div><h3 id="method_getParams"><code class="language-php">getParams()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Parameter.html"><abbr title="nochso\Benchmark\Parameter">Parameter</abbr></a>[]&nbsp;getParams()</code></div></div><div class="details"><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Parameter.html"><abbr title="nochso\Benchmark\Parameter">Parameter</abbr></a>[]</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.84">84</a></div><div><h3 id="method_getResult"><code class="language-php">getResult()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a>&nbsp;getResult()</code></div></div><div class="details"><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a></code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.92">92</a></div><div><h3 id="method_getDescription"><code class="language-php">getDescription()</code></h3><code class="language-php">public string&nbsp;getDescription()</code></div></div><div class="details"><h4>Return Value</h4><table class="table"><tr><td><code class="language-php">string</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.100">100</a></div><div><h3 id="method_setProgress"><code class="language-php">setProgress()</code></h3><code class="language-php">public setProgress(<a href="../../nochso/Benchmark/Progress.html"><abbr title="nochso\Benchmark\Progress">Progress</abbr></a> $progress)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Progress.html"><abbr title="nochso\Benchmark\Progress">Progress</abbr></a></code></td><td><code class="language-php">$progress</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.108">108</a></div><div><h3 id="method_getName"><code class="language-php">getName()</code></h3><code class="language-php">public string&nbsp;getName()</code></div></div><div class="details"><h4>Return Value</h4><table class="table"><tr><td><code class="language-php">string</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.116">116</a></div><div><h3 id="method_addMethod"><code class="language-php">addMethod()</code></h3><code class="language-php">public addMethod(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.126">126</a></div><div><h3 id="method_addClosure"><code class="language-php">addClosure()</code></h3><code class="language-php">public addClosure(<abbr title="nochso\Benchmark\Closure">Closure</abbr> $closure, string $name, string $description = &#039;&#039;)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\Closure">Closure</abbr></code></td><td><code class="language-php">$closure</code></td><td></td></tr><tr><td><code class="language-php">string</code></td><td><code class="language-php">$name</code></td><td></td></tr><tr><td><code class="language-php">string</code></td><td><code class="language-php">$description</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.134">134</a></div><div><h3 id="method_addParam"><code class="language-php">addParam()</code></h3><code class="language-php">public addParam(<abbr title="nochso\Benchmark\nochso\Benchmark\Parameter">Parameter</abbr> $parameter)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Parameter">Parameter</abbr></code></td><td><code class="language-php">$parameter</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.144">144</a></div><div><h3 id="method_run"><code class="language-php">run()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a>&nbsp;run()</code></div></div><div class="details"><div><p>Runs all combinations and returns results grouped by method name.</p></div><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/UnitResult.html"><abbr title="nochso\Benchmark\UnitResult">UnitResult</abbr></a></code></td><td></td></tr></table></div></div><h2>Source code</h2><pre class="language-php line-numbers" id="source"><code>&lt;?php

/*
 * This file is part of nochso/benchmark.
 *
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 * @license   https://github.com/nochso/benchmark/blob/master/LICENSE ISC
 * @link      https://github.com/nochso/benchmark
 */

namespace nochso\Benchmark;

/**
 * Unit is a list of related methods and the parameters they&#039;re called with.
 *
 * The combination of different implementations (Method objects) and their
 * parameters should be related as their results should be comparable.
 *
 * @author Marcel Voigt &lt;mv@noch.so&gt;
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 */
class Unit
{
    /**
     * @var Method[]
     */
    private $methods = array();
    /**
     * @var Parameter[]
     */
    private $params = array();
    /**
     * List of Result objects with varying parameters grouped by method name.
     *
     * @var UnitResult
     */
    private $result;
    /**
     * @var string
     */
    private $name;
    /**
     * @var string
     */
    private $description;
    /**
     * @var Progress
     */
    private $progress;

    /**
     * Both parameters are interpreted as Markdown.
     *
     * @param string $name
     * @param string $description Optional
     */
    public function __construct($name, $description = &#039;&#039;)
    {
        $this-&gt;name = $name;
        $this-&gt;description = $description;
    }

    /**
     * Return first list of all methods. Sorted by score if available.
     *
     * @return Method[]
     */
    public function getMethods()
    {
        return $this-&gt;methods;
    }

    /**
     * @return Parameter[]
     */
    public function getParams()
    {
        return $this-&gt;params;
    }

    /**
     * @return UnitResult
     */
    public function getResult()
    {
        return $this-&gt;result;
    }

    /**
     * @return string
     */
    public function getDescription()
    {
        return $this-&gt;description;
    }

    /**
     * @param Progress $progress
     */
    public function setProgress($progress)
    {
        $this-&gt;progress = $progress;
    }

    /**
     * @return string
     */
    public function getName()
    {
        return $this-&gt;name;
    }

    /**
     * @param Method $method
     */
    public function addMethod(Method $method)
    {
        $this-&gt;methods[$method-&gt;getName()] = $method;
    }

    /**
     * @param \Closure $closure
     * @param string   $name
     * @param string   $description
     */
    public function addClosure(\Closure $closure, $name, $description = &#039;&#039;)
    {
        $this-&gt;methods[$name] = new Method($closure, $name, $description);
    }

    /**
     * @param Parameter $parameter
     */
    public function addParam(Parameter $parameter)
    {
        $this-&gt;params[$parameter-&gt;getName()] = $parameter;
    }

    /**
     * Runs all combinations and returns results grouped by method name.
     *
     * @return UnitResult
     */
    public function run()
    {
        $this-&gt;result = new UnitResult();
        foreach ($this-&gt;methods as $method) {
            $this-&gt;fetchMethodResults($method);
        }
        $this-&gt;sortByMethodScore();
        return $this-&gt;result;
    }

    /**
     * @param Method $method
     */
    private function fetchMethodResults(Method $method)
    {
        $params = $this-&gt;params;
        if (count($params) === 0) {
            $params[] = null;
        }
        foreach ($params as $paramKey =&gt; $parameter) {
            $result = $method-&gt;time($parameter);
            $this-&gt;result-&gt;add($result);
            $this-&gt;notifyProgress();
        }
    }

    private function notifyProgress()
    {
        if ($this-&gt;progress !== null) {
            $this-&gt;progress-&gt;step();
        }
    }

    /**
     * Sort methods best score first.
     */
    private function sortByMethodScore()
    {
        uasort($this-&gt;methods, function ($first, $second) {
            $aScore = $this-&gt;result-&gt;getMethodScore($first);
            $bScore = $this-&gt;result-&gt;getMethodScore($second);
            if ($aScore === $bScore) {
                return 0;
            }
            return $aScore &lt; $bScore ? -1 : 1;
        });
    }
}
</code></pre></div><div class="row"><div id="footer"> Generated by <a href="http://sami.sensiolabs.org/">Sami, the API Documentation Generator</a> using <a href="https://github.com/nochso/sami-theme">nochso/sami-theme</a>. </div></div></div></body></html>