<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="robots" content="index, follow, all" /><title>nochso\Benchmark\UnitResult | noch.so Benchmark documentation</title><link rel="stylesheet" type="text/css" href="../../css/normalize.css"><link rel="stylesheet" type="text/css" href="../../css/min.css"><link rel="stylesheet" type="text/css" href="../../css/prism.css"><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,400italic' rel='stylesheet' type='text/css'><script src="../../js/prism.js"></script><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"></head><body id="class" data-name="class:nochso_Benchmark_UnitResult" data-root-path="../../"><nav><div class="container"><div class="title"><a href="../../index.html">noch.so Benchmark documentation</a></div><ul><li><a href="../../classes.html">Classes</a></li><li><a href="../../namespaces.html">Namespaces</a></li><li><a href="../../interfaces.html">Interfaces</a></li><li><a href="../../traits.html">Traits</a></li><li><a href="../../doc-index.html">Index</a></li><li><a href="../../search.html">Search</a></li></ul><ol class="breadcrumb"><li><a href="../../nochso.html">nochso</a></li><li><a href="../../nochso/Benchmark.html">Benchmark</a></li><li>UnitResult</li></ol></div></nav><div class="container"><div class="row"><div id="control-panel"></div><div id="api-tree"></div></div><div class="row"><h1>UnitResult</h1><p> class <strong>UnitResult</strong></p><p>UnitResult.</p><p>The min/max variables and handling want to be refactored!</p><h2>Methods</h2><table class="table"><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_add">add</a>(<a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a> $result)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]</code></td><td><code class="language-php"><a href="#method_getMethodResults">getMethodResults</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method, bool $includeAverages = false)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td><code class="language-php"><a href="#method_getAverageMethodResult">getAverageMethodResult</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMedianMethodResult">getMedianMethodResult</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMethodScore">getMethodScore</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMethodScoreColor">getMethodScoreColor</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getParameterScore">getParameterScore</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getParameterScoreColor">getParameterScoreColor</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></td><td> No description </td><td></td></tr></table><h2>Details</h2><div id="method-details"><div><div class="float-right"> at line <a href="#source.37">37</a></div><div><h3 id="method_add"><code class="language-php">add()</code></h3><code class="language-php">public add(<a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.48">48</a></div><div><h3 id="method_getMethodResults"><code class="language-php">getMethodResults()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]&nbsp;getMethodResults(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method, bool $includeAverages = false)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr><tr><td><code class="language-php">bool</code></td><td><code class="language-php">$includeAverages</code></td><td></td></tr></table><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.64">64</a></div><div><h3 id="method_getAverageMethodResult"><code class="language-php">getAverageMethodResult()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>&nbsp;getAverageMethodResult(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.76">76</a></div><div><h3 id="method_getMedianMethodResult"><code class="language-php">getMedianMethodResult()</code></h3><code class="language-php">public getMedianMethodResult(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.92">92</a></div><div><h3 id="method_getMethodScore"><code class="language-php">getMethodScore()</code></h3><code class="language-php">public getMethodScore(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.98">98</a></div><div><h3 id="method_getMethodScoreColor"><code class="language-php">getMethodScoreColor()</code></h3><code class="language-php">public getMethodScoreColor(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.112">112</a></div><div><h3 id="method_getParameterScore"><code class="language-php">getParameterScore()</code></h3><code class="language-php">public getParameterScore(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.122">122</a></div><div><h3 id="method_getParameterScoreColor"><code class="language-php">getParameterScoreColor()</code></h3><code class="language-php">public getParameterScoreColor(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div></div><h2>Source code</h2><pre class="language-php line-numbers" id="source"><code>&lt;?php

/*
 * This file is part of nochso/benchmark.
 *
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 * @license   https://github.com/nochso/benchmark/blob/master/LICENSE ISC
 * @link      https://github.com/nochso/benchmark
 */

namespace nochso\Benchmark;

/**
 * UnitResult.
 *
 * The min/max variables and handling want to be refactored!
 *
 * @author Marcel Voigt &lt;mv@noch.so&gt;
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 */
class UnitResult
{
    /**
     * First key is the method name. The inner array is a list of results per method.
     *
     * @var Result[][]
     */
    private $results = array();
    private $maxOpsPerSec = null;
    private $minOpsPerSec = null;
    private $min = array();
    private $max = array();

    /**
     * @param Result $result
     */
    public function add($result)
    {
        $this-&gt;results[$result-&gt;getMethod()-&gt;getName()][] = $result;
    }

    /**
     * @param Method $method
     * @param bool   $includeAverages
     *
     * @return Result[]
     */
    public function getMethodResults(Method $method, $includeAverages = false)
    {
        if ($includeAverages) {
            $results = $this-&gt;results[$method-&gt;getName()];
            $results[] = $this-&gt;getAverageMethodResult($method);
            $results[] = $this-&gt;getMedianMethodResult($method);
            return $results;
        }
        return $this-&gt;results[$method-&gt;getName()];
    }

    /**
     * @param Method $method
     *
     * @return Result
     */
    public function getAverageMethodResult(Method $method)
    {
        $duration = 0.0;
        $operations = 0;
        foreach ($this-&gt;results[$method-&gt;getName()] as $result) {
            $duration += $result-&gt;getDuration();
            $operations += $result-&gt;getOperations();
        }
        $averageResult = new Result($duration, $operations, $method, new Parameter(null, &#039;Average&#039;));
        return $averageResult;
    }

    public function getMedianMethodResult(Method $method)
    {
        $sortedResults = $this-&gt;getMethodResults($method);
        usort($sortedResults, function ($a, $b) {
            $aOps = $a-&gt;getOperationsPerSecond();
            $bOps = $b-&gt;getOperationsPerSecond();
            if ($aOps === $bOps) {
                return 0;
            }
            return $aOps &gt; $bOps ? 1 : -1;
        });
        $medianResult = $sortedResults[(int) (count($sortedResults) / 2)];
        $result = new Result($medianResult-&gt;getDuration(), $medianResult-&gt;getOperations(), $method, new Parameter(null, &#039;Median&#039;));
        return $result;
    }

    public function getMethodScore(Method $method)
    {
        $this-&gt;prepareBoundsMedian();
        return $this-&gt;maxOpsPerSec / $this-&gt;getMedianMethodResult($method)-&gt;getOperationsPerSecond();
    }

    public function getMethodScoreColor(Method $method)
    {
        $this-&gt;prepareBoundsMedian();
        $score = $this-&gt;getMethodScore($method);
        if ($score &lt;= 3) {
            return &#039;#&#039; . $this-&gt;blendHex(&#039;71EF71&#039;, &#039;FFFFFF&#039;, ($score - 1) / 2);
        }
        if ($score &lt;= 6) {
            return &#039;white&#039;;
        }
        $worst = $this-&gt;maxOpsPerSec / $this-&gt;minOpsPerSec;
        return &#039;#&#039; . $this-&gt;blendHex(&#039;FFFFFF&#039;, &#039;FB4E4E&#039;, $score / $worst);
    }

    public function getParameterScore(Result $result)
    {
        $this-&gt;prepareBoundsParameter();
        $paramName = null;
        if ($result-&gt;getParameter() !== null) {
            $paramName = $result-&gt;getParameter()-&gt;getName();
        }
        return $this-&gt;max[&#039;parameter&#039;][$paramName] / $result-&gt;getOperationsPerSecond();
    }

    public function getParameterScoreColor(Result $result)
    {
        $score = $this-&gt;getParameterScore($result);
        if ($score &lt;= 3) {
            return &#039;#&#039; . $this-&gt;blendHex(&#039;71EF71&#039;, &#039;FFFFFF&#039;, ($score - 1) / 2);
        }
        if ($score &lt;= 6) {
            return &#039;#ffffff&#039;;
        }
        $paramName = $result-&gt;getParameter()-&gt;getName();
        $worst = $this-&gt;max[&#039;parameter&#039;][$paramName] / $this-&gt;min[&#039;parameter&#039;][$paramName];
        return &#039;#&#039; . $this-&gt;blendHex(&#039;FFFFFF&#039;, &#039;FB4E4E&#039;, $score / $worst);
    }

    /**
     * Blend two hexadecimal colours specifying the fractional position.
     *
     * Example:
     *     // 10% along the gradient between #66cc00 and #cc2200
     *     blend_hex(&#039;66cc00&#039;, &#039;cc2200&#039;, 0.1); // &quot;70bb00&quot;
     *
     * @link http://www.sitepoint.com/forums/showthread.php?606853-On-a-scale-of-red-to-green&amp;s=79cdcc0fff69e031276f7ab7794b0889&amp;p=4195901&amp;viewfull=1#post4195901
     *
     * @param $fromHex
     * @param $toHex
     * @param float $position
     *
     * @return string
     */
    private function blendHex($fromHex, $toHex, $position = 0.5)
    {
        // 1. Grab RGB fromHex each colour
        list($fromRed, $fromGreen, $fromBlue) = sscanf($fromHex, &#039;%2x%2x%2x&#039;);
        list($toRed, $toGreen, $toBlue) = sscanf($toHex, &#039;%2x%2x%2x&#039;);

        // 2. Calculate colour based on fractional position
        $red = (int) ($fromRed - (($fromRed - $toRed) * $position));
        $green = (int) ($fromGreen - (($fromGreen - $toGreen) * $position));
        $blue = (int) ($fromBlue - (($fromBlue - $toBlue) * $position));

        // 3. Format toHex 6-char HEX colour string
        return sprintf(&#039;%02x%02x%02x&#039;, $red, $green, $blue);
    }

    private function prepareBoundsMedian()
    {
        if ($this-&gt;maxOpsPerSec !== null) {
            return;
        }
        $this-&gt;maxOpsPerSec = 0;
        $this-&gt;minOpsPerSec = PHP_INT_MAX;
        foreach ($this-&gt;results as $methodName =&gt; $results) {
            $res = reset($results);
            $opsPerSec = $this-&gt;getMedianMethodResult($res-&gt;getMethod())-&gt;getOperationsPerSecond();
            $this-&gt;maxOpsPerSec = max($this-&gt;maxOpsPerSec, $opsPerSec);
            $this-&gt;minOpsPerSec = min($this-&gt;minOpsPerSec, $opsPerSec);
        }
    }

    private function prepareBoundsParameter()
    {
        if (isset($this-&gt;max[&#039;parameter&#039;]) &amp;&amp; count($this-&gt;max[&#039;parameter&#039;]) &gt; 0) {
            return;
        }
        $this-&gt;max[&#039;parameter&#039;] = array();
        $this-&gt;min[&#039;parameter&#039;] = array();

        foreach ($this-&gt;results as $methodName =&gt; $results) {
            /** @var Result $first */
            $first = reset($results);
            $method = $first-&gt;getMethod();
            foreach ($this-&gt;getMethodResults($method, true) as $result) {
                $paramName = null;
                if ($result-&gt;getParameter() !== null) {
                    $paramName = $result-&gt;getParameter()-&gt;getName();
                }
                if (!isset($this-&gt;max[&#039;parameter&#039;][$paramName])) {
                    $this-&gt;max[&#039;parameter&#039;][$paramName] = 0;
                }
                if (!isset($this-&gt;min[&#039;parameter&#039;][$paramName])) {
                    $this-&gt;min[&#039;parameter&#039;][$paramName] = PHP_INT_MAX;
                }

                $this-&gt;max[&#039;parameter&#039;][$paramName] = max($this-&gt;max[&#039;parameter&#039;][$paramName], $result-&gt;getOperationsPerSecond());
                $this-&gt;min[&#039;parameter&#039;][$paramName] = min($this-&gt;min[&#039;parameter&#039;][$paramName], $result-&gt;getOperationsPerSecond());
            }
        }
    }
}
</code></pre></div><div class="row"><div id="footer"> Generated by <a href="http://sami.sensiolabs.org/">Sami, the API Documentation Generator</a> using <a href="https://github.com/nochso/sami-theme">nochso/sami-theme</a>. </div></div></div></body></html>