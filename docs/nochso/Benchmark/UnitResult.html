<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="robots" content="index, follow, all" /><title>nochso\Benchmark\UnitResult | noch.so Benchmark documentation</title><link rel="stylesheet" type="text/css" href="../../css/normalize.css"><link rel="stylesheet" type="text/css" href="../../css/min.css"><link rel="stylesheet" type="text/css" href="../../css/prism.css"><link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700,400italic' rel='stylesheet' type='text/css'><script src="../../js/prism.js"></script><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"></head><body id="class" data-name="class:nochso_Benchmark_UnitResult" data-root-path="../../"><nav><div class="container"><div class="title"><a href="../../index.html">noch.so Benchmark documentation</a></div><ul><li><a href="../../classes.html">Classes</a></li><li><a href="../../namespaces.html">Namespaces</a></li><li><a href="../../interfaces.html">Interfaces</a></li><li><a href="../../traits.html">Traits</a></li><li><a href="../../doc-index.html">Index</a></li><li><a href="../../search.html">Search</a></li></ul><ol class="breadcrumb"><li><a href="../../nochso.html">nochso</a></li><li><a href="../../nochso/Benchmark.html">Benchmark</a></li><li>UnitResult</li></ol></div></nav><div class="container"><div class="row"><div id="control-panel"></div><div id="api-tree"></div></div><div class="row"><h1>UnitResult</h1><p> class <strong>UnitResult</strong></p><p>UnitResult.</p><p>The min/max variables and handling want to be refactored!</p><h2>Methods</h2><table class="table"><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method___construct">__construct</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><abbr title="nochso\Benchmark\Result[]">Result[]</abbr>[]</code></td><td><code class="language-php"><a href="#method_getResults">getResults</a>()</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_add">add</a>(<a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a> $result)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]</code></td><td><code class="language-php"><a href="#method_getMethodResults">getMethodResults</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method, bool $includeAverages = false)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td><code class="language-php"><a href="#method_getAverageMethodResult">getAverageMethodResult</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMedianMethodResult">getMedianMethodResult</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMethodScore">getMethodScore</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getMethodScoreColor">getMethodScoreColor</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getParameterScore">getParameterScore</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php"></code></td><td><code class="language-php"><a href="#method_getParameterScoreColor">getParameterScoreColor</a>(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></td><td> No description </td><td></td></tr><tr><td><code class="language-php"> public </code></td><td class="text-right"><code class="language-php">string</code></td><td><code class="language-php"><a href="#method_getScoreColor">getScoreColor</a>(string $path, float $score)</code></td><td> No description </td><td></td></tr></table><h2>Details</h2><div id="method-details"><div><div class="float-right"> at line <a href="#source.36">36</a></div><div><h3 id="method___construct"><code class="language-php">__construct()</code></h3><code class="language-php">public __construct()</code></div></div><div class="details"></div><div><div class="float-right"> at line <a href="#source.44">44</a></div><div><h3 id="method_getResults"><code class="language-php">getResults()</code></h3><code class="language-php">public <abbr title="nochso\Benchmark\Result[]">Result[]</abbr>[]&nbsp;getResults()</code></div></div><div class="details"><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\Result[]">Result[]</abbr>[]</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.52">52</a></div><div><h3 id="method_add"><code class="language-php">add()</code></h3><code class="language-php">public add(<a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.65">65</a></div><div><h3 id="method_getMethodResults"><code class="language-php">getMethodResults()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]&nbsp;getMethodResults(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method, bool $includeAverages = false)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr><tr><td><code class="language-php">bool</code></td><td><code class="language-php">$includeAverages</code></td><td></td></tr></table><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>[]</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.86">86</a></div><div><h3 id="method_getAverageMethodResult"><code class="language-php">getAverageMethodResult()</code></h3><code class="language-php">public <a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a>&nbsp;getAverageMethodResult(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table><h4>Return Value</h4><table class="table"><tr><td><code class="language-php"><a href="../../nochso/Benchmark/Result.html"><abbr title="nochso\Benchmark\Result">Result</abbr></a></code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.98">98</a></div><div><h3 id="method_getMedianMethodResult"><code class="language-php">getMedianMethodResult()</code></h3><code class="language-php">public getMedianMethodResult(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.115">115</a></div><div><h3 id="method_getMethodScore"><code class="language-php">getMethodScore()</code></h3><code class="language-php">public getMethodScore(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.121">121</a></div><div><h3 id="method_getMethodScoreColor"><code class="language-php">getMethodScoreColor()</code></h3><code class="language-php">public getMethodScoreColor(<abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr> $method)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Method">Method</abbr></code></td><td><code class="language-php">$method</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.128">128</a></div><div><h3 id="method_getParameterScore"><code class="language-php">getParameterScore()</code></h3><code class="language-php">public getParameterScore(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.139">139</a></div><div><h3 id="method_getParameterScoreColor"><code class="language-php">getParameterScoreColor()</code></h3><code class="language-php">public getParameterScoreColor(<abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr> $result)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php"><abbr title="nochso\Benchmark\nochso\Benchmark\Result">Result</abbr></code></td><td><code class="language-php">$result</code></td><td></td></tr></table></div><div><div class="float-right"> at line <a href="#source.152">152</a></div><div><h3 id="method_getScoreColor"><code class="language-php">getScoreColor()</code></h3><code class="language-php">public string&nbsp;getScoreColor(string $path, float $score)</code></div></div><div class="details"><h4>Parameters</h4><table class="table"><tr><td><code class="language-php">string</code></td><td><code class="language-php">$path</code></td><td></td></tr><tr><td><code class="language-php">float</code></td><td><code class="language-php">$score</code></td><td></td></tr></table><h4>Return Value</h4><table class="table"><tr><td><code class="language-php">string</code></td><td></td></tr></table></div></div><h2>Source code</h2><pre class="language-php line-numbers" id="source"><code>&lt;?php

/*
 * This file is part of nochso/benchmark.
 *
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 * @license   https://github.com/nochso/benchmark/blob/master/LICENSE ISC
 * @link      https://github.com/nochso/benchmark
 */

namespace nochso\Benchmark;

use nochso\Benchmark\Util\Color;

/**
 * UnitResult.
 *
 * The min/max variables and handling want to be refactored!
 *
 * @author Marcel Voigt &lt;mv@noch.so&gt;
 * @copyright Copyright (c) 2015 Marcel Voigt &lt;mv@noch.so&gt;
 */
class UnitResult
{
    /**
     * First key is the method name. The inner array is a list of results per method.
     *
     * @var Result[][]
     */
    private $results = array();
    /**
     * @var ResultBounds
     */
    private $bounds;

    public function __construct()
    {
        $this-&gt;bounds = new ResultBounds($this);
    }

    /**
     * @return Result[][]
     */
    public function getResults()
    {
        return $this-&gt;results;
    }

    /**
     * @param Result $result
     */
    public function add($result)
    {
        $method = $result-&gt;getMethod();
        $name = $method-&gt;getName();
        $this-&gt;results[$name][] = $result;
    }

    /**
     * @param Method $method
     * @param bool   $includeAverages
     *
     * @return Result[]
     */
    public function getMethodResults(Method $method, $includeAverages = false)
    {
        // When no parameters were used, there&#039;s no point to include averages
        $first = reset($this-&gt;results[$method-&gt;getName()]);
        if ($first-&gt;getParameter() === null) {
            $includeAverages = false;
        }
        if ($includeAverages) {
            $results = $this-&gt;results[$method-&gt;getName()];
            $results[] = $this-&gt;getAverageMethodResult($method);
            $results[] = $this-&gt;getMedianMethodResult($method);
            return $results;
        }
        return $this-&gt;results[$method-&gt;getName()];
    }

    /**
     * @param Method $method
     *
     * @return Result
     */
    public function getAverageMethodResult(Method $method)
    {
        $duration = 0.0;
        $operations = 0;
        foreach ($this-&gt;results[$method-&gt;getName()] as $result) {
            $duration += $result-&gt;getDuration();
            $operations += $result-&gt;getOperations();
        }
        $averageResult = new Result($duration, $operations, $method, new Parameter(null, &#039;Average&#039;));
        return $averageResult;
    }

    public function getMedianMethodResult(Method $method)
    {
        $sortedResults = $this-&gt;getMethodResults($method);
        usort($sortedResults, function (Result $first, Result $second) {
            $firstOps = $first-&gt;getOperationsPerSecond();
            $secondOps = $second-&gt;getOperationsPerSecond();
            if ($firstOps === $secondOps) {
                return 0;
            }
            return $firstOps &gt; $secondOps ? 1 : -1;
        });
        $medianResult = $sortedResults[(int) (count($sortedResults) / 2)];
        $parameter = new Parameter(null, &#039;Median&#039;);
        $result = new Result($medianResult-&gt;getDuration(), $medianResult-&gt;getOperations(), $method, $parameter);
        return $result;
    }

    public function getMethodScore(Method $method)
    {
        $this-&gt;bounds-&gt;prepare();
        return $this-&gt;bounds-&gt;max(&#039;median&#039;) / $this-&gt;getMedianMethodResult($method)-&gt;getOperationsPerSecond();
    }

    public function getMethodScoreColor(Method $method)
    {
        $this-&gt;bounds-&gt;prepare();
        $score = $this-&gt;getMethodScore($method);
        return $this-&gt;getScoreColor(&#039;median&#039;, $score);
    }

    public function getParameterScore(Result $result)
    {
        $this-&gt;bounds-&gt;prepare();
        $paramName = null;
        $parameter = $result-&gt;getParameter();
        if ($parameter !== null) {
            $paramName = $parameter-&gt;getName();
        }
        return $this-&gt;bounds-&gt;max(&#039;parameter.&#039; . $paramName) / $result-&gt;getOperationsPerSecond();
    }

    public function getParameterScoreColor(Result $result)
    {
        $score = $this-&gt;getParameterScore($result);
        $parameter = $result-&gt;getParameter();
        return $this-&gt;getScoreColor(&#039;parameter.&#039; . $parameter-&gt;getName(), $score);
    }

    /**
     * @param string $path
     * @param float  $score
     *
     * @return string
     */
    public function getScoreColor($path, $score)
    {
        $white = new Color(255, 255, 255);
        if ($score &lt;= 3) {
            $green = Color::fromHex(&#039;71EF71&#039;);
            return $green-&gt;blendTo($white, ($score - 1) / 2);
        }
        if ($score &lt;= 6) {
            return $white;
        }
        // Score after 6 to highest fades from white to red.
        $worst = $this-&gt;bounds-&gt;max($path) / $this-&gt;bounds-&gt;min($path);
        $red = Color::fromHex(&#039;FB4E4E&#039;);
        return $white-&gt;blendTo($red, $score / $worst);
    }
}
</code></pre></div><div class="row"><div id="footer"> Generated by <a href="http://sami.sensiolabs.org/">Sami, the API Documentation Generator</a> using <a href="https://github.com/nochso/sami-theme">nochso/sami-theme</a>. </div></div></div></body></html>